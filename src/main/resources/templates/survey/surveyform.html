<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>여행지 추천 플랫폼</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="/css/index.css">
</head>
<body>
    <!-- Survey Modal -->
    <div class="modal fade" id="surveyModal" tabindex="-1" role="dialog" aria-labelledby="surveyModalLabel" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="surveyModalLabel">나의 여행 성향</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="surveyForm">
                        <div id="survey-container"></div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                            <button type="button" class="btn btn-primary" id="next-button" onclick="nextQuestion()">다음</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>

    <script>
        const surveyQuestions = [
            {
                question: "몇 명이서 여행을 가나요?",
                options: ["솔로", "커플", "3명 외 다수"]
            },
            {
                question: "여행 기간은 얼마나 되나요?",
                options: ["1~3일", "4~7일", "8일 이상"]
            },
            // ... 나머지 질문들 동일하게 유지
        ];

        let currentQuestionIndex = 0;
        const surveyAnswers = [];

        function renderQuestion() {
            const currentQuestion = surveyQuestions[currentQuestionIndex];
            const container = document.getElementById("survey-container");
            
            container.innerHTML = `
                <div class="form-group">
                    <label class="font-weight-bold">${currentQuestion.question}</label>
                    ${currentQuestion.options.map((option, index) => ` 
                        <div class="custom-control custom-radio">
                            <input type="radio" class="custom-control-input" id="option${index}" name="surveyAnswer" value="${option}">
                            <label class="custom-control-label" for="option${index}">${option}</label>
                        </div>
                    `).join("")}
                    <small id="surveyHelp" class="form-text text-danger"></small>
                </div>
            `;

            // 마지막 질문인 경우 버튼 텍스트 변경
            const nextButton = document.getElementById("next-button");
            nextButton.textContent = currentQuestionIndex === surveyQuestions.length - 1 ? "제출" : "다음";
        }

        function nextQuestion() {
            const selectedOption = document.querySelector('input[name="surveyAnswer"]:checked');
            const surveyHelp = document.getElementById("surveyHelp");

            if (!selectedOption) {
                surveyHelp.textContent = "옵션을 선택해주세요!";
                return;
            }

            surveyHelp.textContent = "";
            surveyAnswers.push(selectedOption.value);

            if (currentQuestionIndex < surveyQuestions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            } else {
                submitSurvey();
            }
        }

		function submitSurvey() {
		    // Axios를 사용하여 JSON 형식으로 데이터를 전송
		    axios.post('/submitSurvey', {
		        inputs: surveyAnswers  // surveyAnswers 배열을 서버로 전송
		    })
		    .then(response => {
		        alert('설문이 성공적으로 제출되었습니다!');
		        // 서버로부터 받은 응답을 화면에 바로 표시
		        document.getElementById("survey-result").innerText = response.data;
		        // 모달을 숨긴 후 페이지 새로 고침
		        $('#surveyModal').modal('hide');
		        location.reload();  // 페이지 새로 고침
		    })
		    .catch(error => {
		        alert('설문 제출 중 오류가 발생했습니다. 다시 시도해주세요.');
		    });
		}

        function resetSurvey() {
            currentQuestionIndex = 0;
            surveyAnswers.length = 0;
            renderQuestion();
        }

        // 모달이 열릴 때 첫 질문 표시
        $('#surveyModal').on('shown.bs.modal', function () {
            resetSurvey();
        });

        // 모달이 닫힐 때 초기화
        $('#surveyModal').on('hidden.bs.modal', function () {
            resetSurvey();
        });
    </script>

    <div id="survey-result"></div> <!-- 결과 표시 영역 -->

</body>
</html>
